# 貿易に関するデータ流通に関連する技術

## アセットトラッキング

貿易において輸送物の追跡に関する技術は最も根本的な技術要素である。

### 輸送物の位置情報を高頻度で取得する方法

電波信号発信機が発信する電波信号を利用する。

#### 電波信号受信機の位置を割り出す方法

* GPS:  GPS衛星が発信する電波信号を受信した電波信号受信機が自らの位置を算出する
* Wi-Fi: 大きく2つの方式がある
    1. Wi-Fiアクセスポイントからの電波信号を受信した電波信号受信機が電波信号を発信したWi-FiアクセスポイントのMACアドレスを予め登録されているWi-Fiアクセスポイント位置情報データベースに照会して位置情報を取得する
    1. 複数のWi-Fiアクセスポイントからの電波信号を受信した電波信号受信機が電波強度や電波信号到達時間などの違いから三点測位を演算する
* BLE: 複数のビーコン発信機からの電波信号を受信した電波信号受信機が電波強度や電波信号到達時間などの違いから三点測位を演算する
* セルラー基地局: セルラー基地局電波信号を受信した電波信号受信機が取得したCell ID(CID)、Location Area Code (LAC)、Mobile Country Code (MCC)、Mobile Network Code(MNC)を予め登録されているセルラー基地局位置情報データベースに照会して位置情報を取得する

#### 位置が割り出された電波信号受信機と対象物を関連つける方法

* 対象物と電波信号受信機を一体化する
* 電波信号受信機が対象物に貼付されたRFIDやNFCなどの個体識別情報を読み込む
* 画像解析により対象物の個体識別特徴点を取得する

### データ転送方法

IoTにおいて位置情報などの物理的な情報を取得するフィジカル空間と、物理的な情報を集約して様々な処理を施すサイバー空間とのデータ転送は必須である。

#### 無線通信方式

IoTシステムは従来のITシステムとは異なり、システムを構成するデバイスが大量且つ様々なロケーションに散財するため、利用される通信方式の殆どが無線通信を前提としている。

頻繁に利用される無線通信方式はスマートフォンやIoTゲートウェイデバイスが利用しやすい2.4GHz帯の規格と、2.4GHz帯より広範囲の通信を可能にする920MHz帯の規格の2つに分けられる。

* 2.4GHz帯を利用する通信方式: 代表的な通信方式としてWi-Fi、Bluetooth/BLE、Zigbeeなどがあり、2.4GHz付近の電波周波数帯を利用した短・中距離通信方式で、多くの国で無線局免許不要なため最も手軽に利用できる通信方式である
* 920MHz帯を利用する通信方式: 代表的な通信方式としてLPWA（LoRaWAN、Sigfox、NB-IoT）、EnOcean、Z-Wave、Wi-SUNなどがあり、920MHz付近の電波周波数帯を利用した中・長距離通信方式で、多くの国で無線局免許不要だが、多くのデバイスが効率的に帯域を利用するために帯域制限を設ける運用ルールが定められている国もある

#### ネットワークプロトコル

IoTシステムで利用される無線通信方式のうちインターネット・プロトコル・スイートに含まれる方式はWi-Fiのみで、その他の通信方式から取得されるデータは独自プロトコルに従ったデータ形式なため、デバイスが所在するロケーションに配置されたスマートフォンやIoTゲートウェイデバイス内のソフトウェアによって、インターネット・プロトコル・スイートに属するプロトコルに従ったデータ形式へ変換されることが多い。

IoTで主に利用されるインターネット・プロトコル・スイートに属する代表的なプロトコルにはHTTPとMQTTがある。

* HTTP: 元々はHTMLなどのコンテンツの送受信に用いられる通信プロトコルで、非常にシンプルで汎用性が高かったためIoTでも利用されることも多いが、リクエストとレスポンスの双方に必ずメッセージヘッダを付与する必要があり、転送コストが増大することを防ぐ場合には避けられる傾向にある
* MQTT: メッセージ指向ミドルウェアのアプリケーション層で使用される、TCP/IPによるPub/Sub型データ配信モデルの軽量なデータ配信プロトコルで、メッセージが軽量に抑えられる仕様となっていることと、到達保証レベルを指定できるQoSという仕様も含まれる
* UDP: 明確なハンドシェイクを省いたコネクションレスであり、送達確認などを行わない言わば無手順方式のデータ転送で、信頼性・順序性・データ完全性を保証しないため、データ送信のみを行い到達確認が不要の場合に採用されることがある

#### データフロー

IoTシステムは将来的に新たな価値が発生する不確実性を考慮して、どの時点においてもデータフローに対して必要な変更を容易に行える状態を継続的に保つ必要がある。

データフローはプロトコルの差異に起因するデータ形式の変換、様々なロケーションのデータの集約、AI推論モデルの学習データの生成、AIの推論が必要なデータの引き渡し、スマートコントラクトに必要なデータの引き渡し、様々なデータストレージへのデータの引き渡しなどで利用される。

* プロトコルの差異に起因するデータ形式の変換: 主にインターネット・プロトコル・スイートに含まれないプロトコルに従ったデータ形式をインターネット・プロトコル・スイートに含まれるプロトコルに従ったデータ形式へ変換する
* 様々なロケーションのデータの集約: 一定の範囲での傾向を掴むために範囲内のロケーションから取得されたデータを集約する
* AI推論モデルの学習データの生成: AI推論モデルを継続的に学習させるために継続的に学習用データを生成する
* AIの推論が必要なデータの引き渡し: AIの推論が必要なデータをAI推論モデルへ転送する
* スマートコントラクトに必要なデータの引き渡し: スマートコントラクトの自動執行に必要なデータをスマートコントラクトへ転送する
* 様々なデータストレージへのデータの引き渡し: 様々なデータストレージへデータを転送する

#### データストア

IoTで取得されるデータは、その特性として殆どのデータが時系列のビッグデータであるため、データ取得時にデータの活用方法が見出だせていない場合であっても、将来の技術革新によりデータに新たな価値が見出せる可能性を考慮して、どの時点においても取得したデータに対して必要な加工が可能な状態で継続的に蓄積する必要がある。

* データレイク: IoTで取得されるデータを未加工の状態で蓄積するデータストア
* データマート: データレイクから特定の目的に合わせて抽出・加工したデータを格納するデータストア

### データ活用方法

IoTで取得されるデータは、その特性として殆どのデータが時系列のビッグデータであるため、データ活用の前段にMapReduceによるバッチ処理を行い、そこで構造化されたデータをAI推論モデルの学習データとして利用し、そのAI推論モデルをストリームデータ処理やスマートコントラクトの判断部分に利用して、IoTシステムを自動化・自律化するために活用する。

#### MapReduce

コンピュータ・クラスタ上のビッグデータに対する並列コンピューティングを支援するプログラミングモデル。非構造的なファイルシステム若しくは構造的なデータベースの両方をインプット及びアウトプットの対象とすることができる。

* Mapステップ: それぞれのMap処理は他のMap処理と完全独立であり、理論的に全て並列実行することができる
* Reduceステップ: Mapステップでの処理結果を集約し、目的としていた問題に対する結果を何らかの方法によって出力する

#### AI推論モデルの学習

IoTシステムにおいて発生したデータを元にシステムの振る舞いを制御しようとすると、データの発生頻度から考えて人智を超えた自律的な判断が必要になる。

AI推論モデルの学習では構造化されたデータが必要な場合が多く、MapReduceの処理結果をデータマートに書き出して学習データとすることが一般的である。

#### ストリームデータ処理

継続的に発生するタイムスタンプを含むデータをストリームデータと呼び、ストリームデータが発生する度に実行される処理をストリームデータ処理と呼ぶ。

ストリームデータ処理はAIが推論するものもあれば、ある値が閾値を超えた場合にアラートを起こすような単純なものまで含まれる。

#### スマートコントラクト

スマートコントラクトは分散型台帳への記帳の直前でデータの検証や自動執行のために実行される。製造・物流業界などで製品の品質を保証したり、サプライチェーン・リスクを低減するために、IoTデータを分散型台帳に記帳し、追跡可能な形で公開する場合がある。

スマートコントラクトへのデータ転送は如何なる別のシステムも介してはならない。なぜなら発生したデータの改竄を疑われるからである。分散型台帳の耐改竄性を活かすにはデータの発生源となるデバイスから直接記帳する必要がある。

### デバイス状態管理方法

IoTシステムは従来のITシステムとは異なり、システムを構成するデバイスが大量且つ様々なロケーションに散財しており、それぞれのデバイスが物理的にもネットワーク的にも脆弱な環境に置かれている可能性が高い上に、IoTシステムは前述したIoTシステムとIoTデータ活用の不確実性のために変更容易性も備える必要がある。

そのため、それぞれのデバイスとデバイス内のソフトウェアが現在どういう状態にあるか常に把握するだけでなく、遠隔地から適切なタイミングでデバイスに命令したり、適切なソフトウェアへ更新する必要がある。

#### デバイス状態操作

IoTシステムの変更容易性を確保するためには、IoTデバイス内のソフトウェアを更新する仕組みが必須であるが、従来のファームウェアの一括アップデートのようなコストを度外視したような方式ではなく、アップデートする対象を細分化して適切な粒度で更新可能にする仕組みが必要である。

また、IoTデバイス内のソフトウェアの更新の指示は勿論、IoTデバイスに対して何らかのパラメータを渡したり、遠隔からIoTデバイス内の設定を変更するような仕組みも合わせて必要である。

これらの仕組みを構成として、ネットワーク的に防御されたデバイスに対して遠隔から命令するメッセージブローカ、更新対象の実体を保管及びバージョン管理を行うストレージ、処理の振る舞い定義とランタイムが疎結合なデータフローやAI推論モデル、デバイスの構成を冪等性を以てプロビジョニングするツールなどが考えられる。

* 命令を伝えるメッセージブローカ: IoTデバイス側がIoTデバイスに支持する側が命令を書き込む領域を常に監視することによって、IoTデバイスに外部から侵入する脆弱性を作ることなく、遠隔からIoTデバイスに指示することを可能にするために、主にTCP/IPによるPub/Sub型データ配信モデルであるMQTTプロトコルに則たメッセージブローカを介して命令を伝える方式が一般的である
* 更新対象を保管するストレージ: 更新対象となるソフトウェアはバージョン管理された状態で任意のストレージに保管され、メッセージブローカがIoTデバイスにソフトウェアの更新を指示する際に、更新対象のソフトウェアの保管場所についても知らせる
* 処理の振る舞い定義とランタイムが疎結合: 更新対象のソフトウェアの変更箇所が軽微な場合、処理の振る舞いを定義する部分とランタイムが疎結合であると、定義部分の更新のみで事足りるため、更新に関する通信やストレージのコストを抑制できる
* 冪等性を伴ったプロビジョニング: 遠隔からデバイスのソフトウェア構成を構築または変更する場合、、同様の役割を担うデバイス群が同じ状態であることがデバイス管理上望ましいため、構築や変更を何度繰り返しても必ず同じ結果になる冪等性を伴ったプロビジョニングが必要

#### デバイス状態監視

IoTシステムの変更容易性を確保するためには、IoTデバイス内のソフトウェアを更新する仕組みが必要だが、合わせてIoTデバイスの状態を正しく知る仕組みも必要。

現在のデバイス内のソフトウェア構成は勿論、過去のソフトウェア構成、デバイス内のソフトウェアの動作ログ、デバイスの通信状態などを継続的に監視する。

* デバイス内のソフトウェア構成: デバイス内のOS、ドライバ、ミドルウェア、アプリケーション、ライブラリなど各レイヤーの現在の状態
* 過去のソフトウェア構成: デバイス内のOS、ドライバ、ミドルウェア、アプリケーション、ライブラリなど各レイヤー過去のバージョン
* デバイス内のソフトウェアの動作ログ
* デバイスの通信状態

### デバイスセキュリティ及び監査

IoTデバイスは物理的にもネットワーク的にも脆弱な環境に置かれている可能性が高いにも関わらず、デバイスが取得するデータはAI推論モデルの学習に使われたり、分散型台帳に記帳されてスマートコントラクトが自動執行されたりするため、現実世界で起きた真実のデータであるという担保がなされなければ将来的に様々な問題を引き起こす。

具体的な対策としてはトランスポートセキュリティ、デバイスアイデンティティ、ソフトウェア監査の3点が考えられる。

#### ネットワークセキュリティ

デバイスとシステム間、またはデバイス同士の通信において、ネットワーク上の脆弱性に対するセキュリティ施策は、ネットワークを境界にファイアウォールを設け、通信を暗号化することが一般的である。

* ファイアウォール: あるロケーションまたはデバイス自体をネットワークの境界と捉え、そのネットワークの境界でパケットフィルタリングやNATを用いて通信を制御する
* SSL/TLS: ネットワーク上で通信を暗号化し、第三者の盗聴や改竄を防ぐ

#### デバイスアイデンティティ

IoTデバイスからのデータを受信する側は当然ながら送信側が正しい相手であるか何かしらの方法で確かめなければならない。その方法として従来から利用されている公開鍵暗号方式を用いることが一般的である。

従来の公開鍵暗号方式では公開鍵証明書の認証局など特定の主体を信用する必要があるため、将来的にDecentralized Identifiers（DIDs）や分散型台帳を利用したトラストレスな仕組みが用いられる可能性が高い。

#### ソフトウェア監査

デバイスアイデンティティによって成りすましは回避できるとしても、デバイス内のソフトウェアが改竄されることより不正なデータが転送される可能性を残すため、デバイス内のソフトウェアの状態を継続的に監査する必要がある。

* 申告先分散型台帳: 継続的にデバイスのソフトウェアのハッシュ値を記帳する分散型台帳で、この分散型台帳に記帳されたデータを監査することでデバイスの監査を実現する
* 申告クライアント: デバイス内のソフトウェアを定期的にハッシュ化し、申告先分散型台帳へ記帳するクライアントソフトウェア
* Trusted Execution Environment: デバイス内のソフトウェアの状態を申告する申告クライアント自体の改竄を防ぐための仕様で、実装としてはArm TrustZone、Intel SGX、Secure Elementなどがある
